generator client {
  provider     = "prisma-client"
  output       = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model categories {
  id       Int        @id @default(autoincrement())
  name     String     @unique
  products products[]
}

model clicks {
  id            String      @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  promotions_id String?     @db.Uuid
  ip            String?     @db.Inet
  user_agent    String?
  referrer      String?
  landing_url   String?
  created_at    DateTime    @default(now()) @db.Timestamptz(6)
  promotions    promotions? @relation(fields: [promotions_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model products {
  id             String           @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  category_id    Int?
  name           String
  description    String?
  created_at     DateTime         @default(now()) @db.Timestamptz(6)
  product_images product_images[]
  categories     categories?      @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  promotions     promotions[]
}

model promotions {
  id            String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  product_id    String?   @db.Uuid
  store_id      String?   @db.Uuid
  title         String
  summary       String?
  price         Decimal   @db.Decimal(12, 2)
  old_price     Decimal?  @db.Decimal(12, 2)
  currency      String?   @default("BRL") @db.VarChar(6)
  affiliate_url String
  coupon_code   String?
  starts_at     DateTime? @db.Timestamptz(6)
  ends_at       DateTime? @db.Timestamptz(6)
  status        String    @default("active")
  created_at    DateTime  @default(now()) @db.Timestamptz(6)
  updated_at    DateTime  @default(now()) @db.Timestamptz(6)
  clicks        clicks[]
  products      products? @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  stores        stores?   @relation(fields: [store_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model stores {
  id            String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name          String
  website       String?
  contact_email String?
  created_at    DateTime     @default(now()) @db.Timestamptz(6)
  promotions    promotions[]
}

model users {
  id            String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name          String
  email         String   @unique
  password_hash String
  role          String   @default("customer")
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  updated_at    DateTime @default(now()) @db.Timestamptz(6)
}

model product_images {
  id         String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  product_id String?   @db.Uuid
  url        String
  alt_text   String?
  position   Int?      @default(0)
  created_at DateTime  @default(now()) @db.Timestamptz(6)
  products   products? @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}
